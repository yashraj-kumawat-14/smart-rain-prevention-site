
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Rain Prevention - Project Overview</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      margin: 0;
      padding: 0;
      color: #333;
      line-height: 1.6;
    }

    a {
      color: #1e88e5;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 20px 0;
    }

    .highlight {
      background-color: #e3f2fd;
      padding: 10px 15px;
      border-left: 4px solid #1e88e5;
      margin-top: 10px;
    }

    .app-link {
      display: inline-block;
      margin: 15px 0;
      padding: 10px 20px;
      background-color: #1e88e5;
      color: white;
      border-radius: 5px;
      text-decoration: none;
    }

    .app-link:hover {
      background-color: #1565c0;
    }

    header {
      background-color: #1e88e5;
      color: white;
      text-align: center;
      padding: 40px 20px 20px;
    }

    header h1 {
      margin: 0;
      font-size: 2em;
    }

    nav {
      background-color: #444;
      text-align: center;
      padding: 10px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    nav a {
      color: white;
      margin: 5px 15px;
      font-weight: bold;
    }

    main {
      max-width: 1000px;
      width: 90%;
      margin: 30px auto;
      padding: 20px;
      background-color: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      box-sizing: border-box;
    }

    h2 {
      color: #1e88e5;
      margin-top: 30px;
      font-size: 1.5em;
    }

    ul, ol {
      line-height: 1.7;
      padding-left: 20px;
    }

    pre {
      overflow-x: auto;
      padding: 10px;
      border-radius: 6px;
      background-color: #2b2b2b;
      color: #f0f0f0;
      font-size: 0.9em;
    }

    footer {
      background-color: #1e88e5;
      color: white;
      text-align: center;
      padding: 20px;
      margin-top: 40px;
    }

    .video-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      margin: 20px 0;
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    @media (max-width: 768px) {
      header h1 {
        font-size: 1.5em;
      }

      nav a {
        margin: 5px 10px;
        font-size: 0.9em;
      }

      h2 {
        font-size: 1.3em;
      }

      .app-link {
        padding: 8px 16px;
        font-size: 0.9em;
      }
    }

    @media (max-width: 480px) {
      main {
        padding: 15px;
      }

      nav {
        flex-direction: column;
        padding: 5px 0;
      }

      nav a {
        margin: 5px 0;
      }

      header {
        padding: 30px 10px 15px;
      }

      h2 {
        font-size: 1.1em;
      }
    }
  </style>
</head>
<body>

  <header>
    <h1>Smart Rain Prevention Project</h1>
    <p><strong>Automatic Clothes Drying Protection System</strong></p>
  </header>

  <nav>
    <a href="#overview">Overview</a>
    <a href="#features">Features</a>
    <a href="#components">Components</a>
    <a href="#setup">Setup Guide</a>
    <a href="#code">Code</a>
    <a href="#demo-video">Demo</a>
    <a href="#support">Support</a>
  </nav>

  <main>

    <section id="overview">
      <h2>Overview</h2>
      <p>
        The Smart Rain Prevention system is designed to automatically move your clothes drying rack indoors when it starts to rain and extend it back outdoors once the rain stops. 
        It can operate in both automatic mode and manual mode via MQTT commands and provides real-time status updates to ThingSpeak.
      </p>
    </section>

    <section id="demo-video">
      <h2>Project Demonstration Video</h2>
      <div class="video-container">
        <!-- Replace with your actual demo video link -->
        <iframe src="https://drive.google.com/file/d/your-demo-video-id/preview" allow="autoplay" allowfullscreen></iframe>
      </div>
    </section>

    <section id="features">
      <h2>Key Features</h2>
      <ul>
        <li>Automatic rain detection using a rain sensor.</li>
        <li>Motorized clothes drying system with forward and backward limit switches.</li>
        <li>Manual control through MQTT over a web interface.</li>
        <li>Automatic and manual modes with easy switching.</li>
        <li>ThingSpeak integration for real-time clothes position monitoring.</li>
        <li>Configurable motor speed and safety limit switches to prevent damage.</li>
      </ul>
    </section>

    <section id="components">
      <h2>Hardware Components</h2>
      <ul>
        <li>ESP8266 NodeMCU or similar WiFi-enabled microcontroller</li>
        <li>DC Motor with driver (L298N or similar)</li>
        <li>Rain Sensor</li>
        <li>Limit Switches (Forward and Backward)</li>
        <li>Power Supply (5V-12V depending on motor)</li>
        <li>Jumper Wires and Mounting Hardware</li>
      </ul>
    </section>

    <section id="code">
      <h2>Arduino Code</h2>
      <p>You can download the full Arduino sketch from the link below:</p>
      <a class="app-link" href="./smart_rain_prevention.ino" download>üì• Download Full Code</a>
      <pre><code>
// Code snippet preview...
#include <ESP8266WiFi.h>
#include <PubSubClient.h>
#include <ESP8266HTTPClient.h>

// ---------------- WiFi ----------------
const char* ssid = "yantrigo";
const char* password = "rx*yx14*rx";

// ---------------- MQTT ----------------
const char* mqtt_server = "test.mosquitto.org";
const char* mqtt_topic = "smart_clothes/cmd";
WiFiClient espClient;
PubSubClient client(espClient);

// ---------------- ThingSpeak ----------------
const char* thingspeak_host = "http://api.thingspeak.com/update";
String apiKey = "SVBO243TZVQPEKP3";
WiFiClient httpClient;

// ---------------- Pins ----------------
#define ENA D8
#define IN1 D2
#define IN2 D3
#define RAIN_SENSOR D5
#define LIMIT_FORWARD D6
#define LIMIT_BACKWARD D7

// ---------------- Config ----------------
const int MOTOR_SPEED = 200;  // ~5% speed
unsigned long lastThingSpeak = 0;
const unsigned long thingSpeakInterval = 20000; // 20s

// ---------------- State ----------------
enum Motion { STOPPED, MOVING_IN, MOVING_OUT };
Motion motionState = STOPPED;
String clothesState = "STOP";

bool manual = false;          // true = obey last MQTT command, false = automatic
String lastCmd = "STOP";      // last command received via MQTT
bool wifiConnected = false;

// ---------------- Motor Control ----------------
void stopMotor() {
  analogWrite(ENA, 0);
  digitalWrite(IN1, LOW);
  digitalWrite(IN2, LOW);
  motionState = STOPPED;
  clothesState = "STOP";
}

void startMoveIn() {
  if (digitalRead(LIMIT_FORWARD) == LOW) {
    stopMotor();
    return;
  }
  digitalWrite(IN1, HIGH);
  digitalWrite(IN2, LOW);
  analogWrite(ENA, MOTOR_SPEED);
  motionState = MOVING_IN;
  clothesState = "IN";
}

void startMoveOut() {
  if (digitalRead(LIMIT_BACKWARD) == LOW) {
    stopMotor();
    return;
  }
  digitalWrite(IN1, LOW);
  digitalWrite(IN2, HIGH);
  analogWrite(ENA, MOTOR_SPEED);
  motionState = MOVING_OUT;
  clothesState = "OUT";
}

// ---------------- MQTT Callback ----------------
void callback(char* topic, byte* payload, unsigned int length) {
  String msg;
  for (unsigned int i = 0; i < length; i++) msg += (char)payload[i];
  msg.trim();
  msg.toUpperCase();

  lastCmd = msg;
  manual = true;  // whenever a MQTT command comes, enter manual mode
}

// ---------------- WiFi Setup ----------------
void setup_wifi() {
  WiFi.begin(ssid, password);
  Serial.print("Connecting to Wi-Fi");
  unsigned long startAttempt = millis();
  while (WiFi.status() != WL_CONNECTED && millis() - startAttempt < 15000) {
    delay(500);
    Serial.print(".");
  }
  wifiConnected = (WiFi.status() == WL_CONNECTED);
  if (wifiConnected) Serial.println("\nWiFi Connected!");
  else Serial.println("\nWiFi Connection Failed!");
}

// ---------------- MQTT Reconnect ----------------
void reconnect() {
  if (!wifiConnected) return;
  while (!client.connected()) {
    if (client.connect("SmartClothesClient")) {
      client.subscribe(mqtt_topic);
      Serial.println("MQTT Connected & Subscribed");
    } else {
      delay(2000);
    }
  }
}

// ---------------- ThingSpeak ----------------
/*void sendThingSpeak(String state) {
  if (!wifiConnected) return;

  int value = 0;
  if (state == "IN") value = 1;
  else if (state == "OUT") value = 2;

  HTTPClient http;
  String url = String(thingspeak_host) + "?api_key=" + apiKey + "&field1=" + String(value);

  http.begin(httpClient, url);
  int httpResponse = http.GET();
  if (httpResponse > 0) {
    Serial.print("ThingSpeak response code: ");
    Serial.println(httpResponse);
  } else {
    Serial.print("Error sending to ThingSpeak: ");
    Serial.println(httpResponse);
  }
  http.end();
}*/

void sendThingSpeak(String state) {
  if (!wifiConnected) return;

  int value = 0;
  if (state == "IN") value = 1;
  else if (state == "OUT") value = 2;
  else return; // Skip sending STOP state

  HTTPClient http;
  String url = String(thingspeak_host) + "?api_key=" + apiKey + "&field1=" + String(value);

  http.begin(httpClient, url);
  int httpResponse = http.GET();
  if (httpResponse > 0) {
    Serial.print("ThingSpeak response code: ");
    Serial.println(httpResponse);
  } else {
    Serial.print("Error sending to ThingSpeak: ");
    Serial.println(httpResponse);
  }
  http.end();
}


// ---------------- Setup ----------------
void setup() {
  Serial.begin(115200);
  setup_wifi();

  if (wifiConnected) {
    client.setServer(mqtt_server, 1883);
    client.setCallback(callback);
  }

  pinMode(ENA, OUTPUT);
  pinMode(IN1, OUTPUT);
  pinMode(IN2, OUTPUT);
  pinMode(RAIN_SENSOR, INPUT);
  pinMode(LIMIT_FORWARD, INPUT_PULLUP);
  pinMode(LIMIT_BACKWARD, INPUT_PULLUP);

  stopMotor();
  Serial.println("Smart Rain Prevention System Ready");
}

// ---------------- Loop ----------------
void loop() {
  // MQTT handling
  if (wifiConnected) {
    if (!client.connected()) reconnect();
    client.loop();
  }

  // Stop motor if limits reached
  if (motionState == MOVING_IN && digitalRead(LIMIT_FORWARD) == LOW) stopMotor();
  if (motionState == MOVING_OUT && digitalRead(LIMIT_BACKWARD) == LOW) stopMotor();

  // Control logic
  if (manual) {
    // obey last MQTT command
    if (motionState == STOPPED) {
    if (lastCmd == "IN" && digitalRead(LIMIT_FORWARD) == HIGH) startMoveIn();
    else if (lastCmd == "OUT" && digitalRead(LIMIT_BACKWARD) == HIGH) startMoveOut();
    else if(lastCmd == "AUTO"){
      manual=false;
    }}

    if (lastCmd == "STOP") stopMotor();
  } else {
    // automatic mode
    if (motionState == STOPPED) {
      if (digitalRead(RAIN_SENSOR) == LOW && digitalRead(LIMIT_FORWARD) == HIGH) startMoveIn();
      else if (digitalRead(RAIN_SENSOR) == HIGH && digitalRead(LIMIT_BACKWARD) == HIGH) startMoveOut();
    }
  }

  // Reset manual if motor stops
  //if (manual && motionState == STOPPED) manual = false;

  // ThingSpeak update every 20s
  if (wifiConnected && millis() - lastThingSpeak > thingSpeakInterval) {
    lastThingSpeak = millis();
    sendThingSpeak(clothesState);
  }
}

// Motor control functions omitted for brevity
      </code></pre>
    </section>

    <section id="setup">
      <h2>Setup Instructions</h2>
      <ol>
        <li>Wire the motor, rain sensor, and limit switches according to the Arduino code pin configuration.</li>
        <li>Upload the provided Arduino sketch to your NodeMCU or ESP8266 board.</li>
        <li>Connect the device to your WiFi network for MQTT and ThingSpeak functionality.</li>
        <li>Test the system in both automatic and manual modes using the web interface or MQTT commands.</li>
        <li>Ensure limit switches are properly positioned to prevent motor damage.</li>
      </ol>
      <div class="highlight">
        Note: The system only reports ‚ÄúClothes are inside‚Äù or ‚ÄúClothes are outside‚Äù to ThingSpeak to avoid sending the STOP state.
      </div>
    </section>

    <section id="support">
      <h2>Support & Contact</h2>
      <p>If you need help with setup or have questions, feel free to contact:</p>
      <ul>
        <li>Email: <a href="mailto:yashrajkumawat7357@gmail.com">yashrajkumawat7357@gmail.com</a></li>
      </ul>
    </section>

  </main>

  <footer>
    <p>&copy; 2025 Smart Rain Prevention Project. All rights reserved.</p>
  </footer>

</body>
</html>
